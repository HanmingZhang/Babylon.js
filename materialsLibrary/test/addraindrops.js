window.prepareRainDrops = function() {
	var raindrops = new BABYLON.RaindropsMaterial("raindrops", scene);
	raindrops.backFaceCulling = false;
	raindrops.enableRenderTargets(false);
	//raindrops.bumpTexture = new BABYLON.Texture("/playground/textures/waterbump.png", scene);
	raindrops.bumpTexture = new BABYLON.Texture("../assets/Raindrops_normal.bmp", scene);
	raindrops.raindropTexture = new BABYLON.Texture("../assets/Raindrops_normal.bmp", scene);
	raindrops.windForce = 45;
	raindrops.waveHeight = 1.3;
	raindrops.windDirection = new BABYLON.Vector2(1, 1);
					
	registerRangeUI("raindrops", "windForce", 0, 100, function(value) {
		raindrops.windForce = value;
	}, function() {
		return raindrops.windForce;
	});
	
	registerRangeUI("raindrops", "waveHeight", 0, 20, function(value) {
		raindrops.waveHeight = value;
	}, function() {
		return raindrops.waveHeight;
	});
	
	registerRangeUI("raindrops", "bumpHeight", 0, 10, function(value) {
		raindrops.bumpHeight = value;
	}, function() {
		return raindrops.bumpHeight;
	});
	
	registerRangeUI("raindrops", "colorBlendFactor", 0, 1, function(value) {
		raindrops.colorBlendFactor = value;
	}, function() {
		return raindrops.colorBlendFactor;
	});
	
	registerRangeUI("raindrops", "waveLength", 0, 1, function(value) {
		raindrops.waveLength = value;
	}, function() {
		return raindrops.waveLength;
	});
	
	registerRangeUI("raindrops", "waveSpeed", 0, 100, function(value) {
		raindrops.waveSpeed = value;
	}, function() {
		return raindrops.waveSpeed;
	});
	
	// Specular color
	registerColorPicker("raindrops", "specularColor", "#703605", function(value) {		
		raindrops.specularColor.r = value.r/255;
		raindrops.specularColor.g = value.g/255;
		raindrops.specularColor.b = value.b/255;
	}, function() {
		return raindrops.specularColor;
	});

	registerRangeUI("raindrops", "specularPower", 0, 512, function(value) {
		raindrops.specularPower = value;
	}, function() {
		return raindrops.specularPower;
	});

	// Advanced
	registerRangeUI("raindrops", "bumpSuperimpose", 0, 1, function(value) {
		raindrops.bumpSuperimpose = value;
	}, function() {
		return raindrops.bumpSuperimpose;
	});

	registerRangeUI("raindrops", "fresnelSeparate", 0, 1, function(value) {
		raindrops.fresnelSeparate  = value;
	}, function() {
		return raindrops.fresnelSeparate ;
	});
		
	registerRangeUI("raindrops", "bumpAffectsReflection", 0, 1, function(value) {
		raindrops.bumpAffectsReflection  = value;
	}, function() {
		return raindrops.bumpAffectsReflection ;
	});

	registerRangeUI("raindrops", "colorBlendFactor2", 0, 1, function(value) {
		raindrops.colorBlendFactor2 = value;
	}, function() {
		return raindrops.colorBlendFactor2;
	});

	registerColorPicker("raindrops", "raindropsColor", "#703605", function(value) {		
		raindrops.raindropsColor.r = value.r/255;
		raindrops.raindropsColor.g = value.g/255;
		raindrops.raindropsColor.b = value.b/255;
	}, function() {
		return raindrops.raindropsColor;
	});

	registerColorPicker("raindrops", "raindropsColor2", "#703605", function(value) {		
		raindrops.raindropsColor2.r = value.r/255;
		raindrops.raindropsColor2.g = value.g/255;
		raindrops.raindropsColor2.b = value.b/255;
	}, function() {
		return raindrops.raindropsColor2;
	});

	return raindrops;
}